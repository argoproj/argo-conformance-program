go test -v -timeout 10m -count 1 --tags functional -p 1 ./test/e2e
=== RUN   TestFunctionalSuite
    e2e_suite.go:78: Creating event bus argo-events-e2e
    e2e_suite.go:80: EventBus is ready
=== RUN   TestFunctionalSuite/TestCreateCalendarEventSource
    functional_test.go:50: Creating event source e2e-calendar
    functional_test.go:51: Pod of EventSource e2e-calendar is running
Watching POD: e2e-calendar-eventsource-btb4c-7dc98b78b6-d69lq
{"level":"info","ts":1641125806.663343,"logger":"argo-events.eventsource","caller":"metrics/metrics.go:172","msg":"starting metrics server","eventSourceName":"e2e-calendar"}
{"level":"warn","ts":1641125806.6680286,"logger":"argo-events.eventsource","caller":"cmd/start.go:66","msg":"WARNING: unable to initialise Codefresh API","eventSourceName":"e2e-calendar","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125806.6680784,"logger":"argo-events.eventsource","caller":"cmd/start.go:69","msg":"starting eventsource server","eventSourceName":"e2e-calendar","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125806.6698887,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","eventSourceName":"e2e-calendar"}
{"level":"info","ts":1641125807.5693312,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","eventSourceName":"e2e-calendar"}
{"level":"info","ts":1641125807.5697193,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","eventSourceName":"e2e-calendar"}
{"level":"info","ts":1641125807.5697849,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:322","msg":"Starting event source server...","eventSourceName":"e2e-calendar"}
{"level":"info","ts":1641125807.570164,"logger":"argo-events.eventsource","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","eventSourceName":"e2e-calendar","clientID":"client-e2e-calendar-eventsource-btb4c-7dc98b78b6-d69lq-265"}
{"level":"info","ts":1641125807.5737863,"logger":"argo-events.eventsource","caller":"driver/nats.go:105","msg":"Connected to NATS server.","eventSourceName":"e2e-calendar","clientID":"client-e2e-calendar-eventsource-btb4c-7dc98b78b6-d69lq-265"}
{"level":"error","ts":1641125807.5741465,"logger":"argo-events.eventsource","caller":"driver/nats.go:115","msg":"Failed to connect to NATS streaming server","eventSourceName":"e2e-calendar","clientID":"client-e2e-calendar-eventsource-btb4c-7dc98b78b6-d69lq-265","error":"nats: no responders available for request","stacktrace":"github.com/argoproj/argo-events/eventbus/driver.(*natsStreaming).Connect\n\t/home/runner/work/argo-events/argo-events/eventbus/driver/nats.go:115\ngithub.com/argoproj/argo-events/eventsources.(*EventSourceAdaptor).run.func1\n\t/home/runner/work/argo-events/argo-events/eventsources/eventing.go:335\ngithub.com/argoproj/argo-events/common.Connect.func1\n\t/home/runner/work/argo-events/argo-events/common/retry.go:107\nk8s.io/apimachinery/pkg/util/wait.runConditionWithCrashProtection\n\t/home/runner/go/pkg/mod/k8s.io/apimachinery@v0.20.4-rc.0/pkg/util/wait/wait.go:211\nk8s.io/apimachinery/pkg/util/wait.ExponentialBackoff\n\t/home/runner/go/pkg/mod/k8s.io/apimachinery@v0.20.4-rc.0/pkg/util/wait/wait.go:399\ngithub.com/argoproj/argo-events/common.Connect\n\t/home/runner/work/argo-events/argo-events/common/retry.go:106\ngithub.com/argoproj/argo-events/eventsources.(*EventSourceAdaptor).run\n\t/home/runner/work/argo-events/argo-events/eventsources/eventing.go:334\ngithub.com/argoproj/argo-events/eventsources.(*EventSourceAdaptor).Start.func1\n\t/home/runner/work/argo-events/argo-events/eventsources/eventing.go:308"}
{"level":"info","ts":1641125808.6369705,"logger":"argo-events.eventsource","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","eventSourceName":"e2e-calendar","clientID":"client-e2e-calendar-eventsource-btb4c-7dc98b78b6-d69lq-265"}
{"level":"info","ts":1641125808.6402104,"logger":"argo-events.eventsource","caller":"driver/nats.go:105","msg":"Connected to NATS server.","eventSourceName":"e2e-calendar","clientID":"client-e2e-calendar-eventsource-btb4c-7dc98b78b6-d69lq-265"}
{"level":"error","ts":1641125808.6408758,"logger":"argo-events.eventsource","caller":"driver/nats.go:115","msg":"Failed to connect to NATS streaming server","eventSourceName":"e2e-calendar","clientID":"client-e2e-calendar-eventsource-btb4c-7dc98b78b6-d69lq-265","error":"nats: no responders available for request","stacktrace":"github.com/argoproj/argo-events/eventbus/driver.(*natsStreaming).Connect\n\t/home/runner/work/argo-events/argo-events/eventbus/driver/nats.go:115\ngithub.com/argoproj/argo-events/eventsources.(*EventSourceAdaptor).run.func1\n\t/home/runner/work/argo-events/argo-events/eventsources/eventing.go:335\ngithub.com/argoproj/argo-events/common.Connect.func1\n\t/home/runner/work/argo-events/argo-events/common/retry.go:107\nk8s.io/apimachinery/pkg/util/wait.runConditionWithCrashProtection\n\t/home/runner/go/pkg/mod/k8s.io/apimachinery@v0.20.4-rc.0/pkg/util/wait/wait.go:211\nk8s.io/apimachinery/pkg/util/wait.ExponentialBackoff\n\t/home/runner/go/pkg/mod/k8s.io/apimachinery@v0.20.4-rc.0/pkg/util/wait/wait.go:399\ngithub.com/argoproj/argo-events/common.Connect\n\t/home/runner/work/argo-events/argo-events/common/retry.go:106\ngithub.com/argoproj/argo-events/eventsources.(*EventSourceAdaptor).run\n\t/home/runner/work/argo-events/argo-events/eventsources/eventing.go:334\ngithub.com/argoproj/argo-events/eventsources.(*EventSourceAdaptor).Start.func1\n\t/home/runner/work/argo-events/argo-events/eventsources/eventing.go:308"}
{"level":"info","ts":1641125810.1968436,"logger":"argo-events.eventsource","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","eventSourceName":"e2e-calendar","clientID":"client-e2e-calendar-eventsource-btb4c-7dc98b78b6-d69lq-265"}
{"level":"info","ts":1641125810.19888,"logger":"argo-events.eventsource","caller":"driver/nats.go:105","msg":"Connected to NATS server.","eventSourceName":"e2e-calendar","clientID":"client-e2e-calendar-eventsource-btb4c-7dc98b78b6-d69lq-265"}
{"level":"info","ts":1641125810.2011952,"logger":"argo-events.eventsource","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","eventSourceName":"e2e-calendar","clientID":"client-e2e-calendar-eventsource-btb4c-7dc98b78b6-d69lq-265"}
{"level":"info","ts":1641125810.2012472,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:466","msg":"Eventing server started.","eventSourceName":"e2e-calendar"}
{"level":"info","ts":1641125810.201333,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:354","msg":"starting eventbus connection daemon...","eventSourceName":"e2e-calendar"}
{"level":"info","ts":1641125810.2014313,"logger":"argo-events.eventsource","caller":"calendar/start.go:141","msg":"started processing the calendar event source...","eventSourceName":"e2e-calendar","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125810.2014434,"logger":"argo-events.eventsource","caller":"calendar/start.go:144","msg":"resolving calendar schedule...","eventSourceName":"e2e-calendar","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125810.2014575,"logger":"argo-events.eventsource","caller":"calendar/start.go:150","msg":"parsing exclusion dates if any...","eventSourceName":"e2e-calendar","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125810.2014616,"logger":"argo-events.eventsource","caller":"calendar/start.go:162","msg":"Persistence not enabled","eventSourceName":"e2e-calendar","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125810.201471,"logger":"argo-events.eventsource","caller":"calendar/start.go:225","msg":"Calendar event start time:","eventSourceName":"e2e-calendar","eventSourceType":"calendar","eventName":"example","Time":"02 Jan 22 12:16 UTC"}
{"level":"info","ts":1641125810.2015016,"logger":"argo-events.eventsource","caller":"calendar/start.go:249","msg":"expected next calendar event","eventSourceName":"e2e-calendar","eventSourceType":"calendar","eventName":"example","time":"2022-01-02 12:16:52 +0000 UTC"}
{"level":"info","ts":1641125812.0005918,"logger":"argo-events.eventsource","caller":"calendar/start.go:209","msg":"dispatching calendar event...","eventSourceName":"e2e-calendar","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125812.0036774,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:451","msg":"succeeded to publish an event","eventSourceName":"e2e-calendar","eventName":"example","eventSourceType":"calendar","eventID":"62333564333166632d366635372d343461392d393835362d633564626263613031623963"}
    functional_test.go:57: Creating sensor e2e-log
    functional_test.go:58: Pod of Sensor e2e-log is running
Watching POD: e2e-log-sensor-727vd-55d44f67f-h6m4t
{"level":"info","ts":1641125812.7371826,"logger":"argo-events.sensor","caller":"metrics/metrics.go:172","msg":"starting metrics server","sensorName":"e2e-log"}
{"level":"warn","ts":1641125812.7417395,"logger":"argo-events.sensor","caller":"cmd/start.go:76","msg":"WARNING: unable to initialise Codefresh API","sensorName":"e2e-log","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125812.7417817,"logger":"argo-events.sensor","caller":"cmd/start.go:79","msg":"starting sensor server","sensorName":"e2e-log","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125812.743805,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","sensorName":"e2e-log"}
{"level":"info","ts":1641125813.480427,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","sensorName":"e2e-log"}
{"level":"info","ts":1641125813.4810224,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","sensorName":"e2e-log"}
{"level":"info","ts":1641125813.4811728,"logger":"argo-events.sensor","caller":"sensors/listener.go:344","msg":"Sensor started.","sensorName":"e2e-log"}
{"level":"info","ts":1641125813.4812784,"logger":"argo-events.sensor","caller":"sensors/listener.go:490","msg":"Dependency expression for trigger log-trigger: test-dep","sensorName":"e2e-log"}
{"level":"info","ts":1641125813.4817228,"logger":"argo-events.sensor","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","sensorName":"e2e-log","triggerName":"log-trigger","clientID":"client-426166059-45"}
{"level":"info","ts":1641125813.4846666,"logger":"argo-events.sensor","caller":"driver/nats.go:105","msg":"Connected to NATS server.","sensorName":"e2e-log","triggerName":"log-trigger","clientID":"client-426166059-45"}
{"level":"info","ts":1641125813.4865282,"logger":"argo-events.sensor","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","sensorName":"e2e-log","triggerName":"log-trigger","clientID":"client-426166059-45"}
{"level":"info","ts":1641125813.4866474,"logger":"argo-events.sensor","caller":"sensors/listener.go:303","msg":"starting eventbus connection daemon for client client-426166059-45...","sensorName":"e2e-log"}
{"level":"info","ts":1641125813.4867485,"logger":"argo-events.sensor","caller":"sensors/listener.go:255","msg":"started subscribing to events for trigger log-trigger with client client-426166059-45","sensorName":"e2e-log"}
{"level":"info","ts":1641125813.488389,"logger":"argo-events.sensor","caller":"driver/nats.go:161","msg":"Subscribed to subject eventbus-argo-events ...","sensorName":"e2e-log","triggerName":"log-trigger","clientID":"client-426166059-45"}
{"level":"info","ts":1641125813.4885373,"logger":"argo-events.sensor","caller":"driver/nats.go:169","msg":"starting ExactOnce cache clean up daemon ...","sensorName":"e2e-log","triggerName":"log-trigger","clientID":"client-426166059-45"}
{"level":"info","ts":1641125814.0021262,"logger":"argo-events.sensor","caller":"log/log.go:46","msg":"{\"eventTime\":\"2022-01-02 12:16:54.000080985 +0000 UTC m=+7.376157075\"}","sensorName":"e2e-log","triggerName":"log-trigger","triggerType":"Log","dependencyName":"test-dep","eventContext":"{\"id:\" \"37613438613631302d343532352d343465652d393235652d383135316236306432386362\", \"source\": \"e2e-calendar\", \"specversion\": \"1.0\", \"type\": \"calendar\", \"datacontenttype\": \"application/json\", \"subject\": \"example\", \"time\": \"2022-01-02 12:16:54.000193686 +0000 UTC\"}"}
{"level":"info","ts":1641125814.0023174,"logger":"argo-events.sensor","caller":"sensors/listener.go:434","msg":"successfully processed the trigger","sensorName":"e2e-log","triggerName":"log-trigger","triggerType":"Log","triggeredBy":["test-dep"],"triggeredByEvents":["37613438613631302d343532352d343465652d393235652d383135316236306432386362"]}
=== RUN   TestFunctionalSuite/TestCreateCalendarEventSourceWithHA
    functional_test.go:66: Creating event source e2e-calendar-ha
    functional_test.go:67: Pod of EventSource e2e-calendar-ha is running
    functional_test.go:68: Waiting for 3s
    functional_test.go:68: Done waiting
Watching POD: e2e-calendar-ha-eventsource-mvcgl-795d7fddd7-7dbmq
Watching POD: e2e-calendar-ha-eventsource-mvcgl-795d7fddd7-bfg27
{"level":"info","ts":1641125814.7732701,"logger":"argo-events.eventsource","caller":"metrics/metrics.go:172","msg":"starting metrics server","eventSourceName":"e2e-calendar-ha"}
{"level":"warn","ts":1641125814.7909462,"logger":"argo-events.eventsource","caller":"cmd/start.go:66","msg":"WARNING: unable to initialise Codefresh API","eventSourceName":"e2e-calendar-ha","error":"configmaps \"codefresh-cm\" not found"}
{"level":"info","ts":1641125814.7909927,"logger":"argo-events.eventsource","caller":"cmd/start.go:69","msg":"starting eventsource server","eventSourceName":"e2e-calendar-ha","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125814.8015997,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","eventSourceName":"e2e-calendar-ha"}
{"level":"info","ts":1641125815.6161594,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","eventSourceName":"e2e-calendar-ha"}
{"level":"info","ts":1641125815.6178586,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","eventSourceName":"e2e-calendar-ha"}
{"level":"info","ts":1641125815.6179333,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:322","msg":"Starting event source server...","eventSourceName":"e2e-calendar-ha"}
{"level":"info","ts":1641125815.618376,"logger":"argo-events.eventsource","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","eventSourceName":"e2e-calendar-ha","clientID":"client-e2e-calendar-ha-eventsource-mvcgl-795d7fddd7-bfg27-556"}
{"level":"info","ts":1641125815.6196172,"logger":"argo-events.eventsource","caller":"driver/nats.go:105","msg":"Connected to NATS server.","eventSourceName":"e2e-calendar-ha","clientID":"client-e2e-calendar-ha-eventsource-mvcgl-795d7fddd7-bfg27-556"}
{"level":"info","ts":1641125815.6208744,"logger":"argo-events.eventsource","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","eventSourceName":"e2e-calendar-ha","clientID":"client-e2e-calendar-ha-eventsource-mvcgl-795d7fddd7-bfg27-556"}
{"level":"info","ts":1641125815.6211805,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:466","msg":"Eventing server started.","eventSourceName":"e2e-calendar-ha"}
{"level":"info","ts":1641125815.6211884,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:354","msg":"starting eventbus connection daemon...","eventSourceName":"e2e-calendar-ha"}
{"level":"info","ts":1641125815.6213746,"logger":"argo-events.eventsource","caller":"calendar/start.go:141","msg":"started processing the calendar event source...","eventSourceName":"e2e-calendar-ha","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125815.6213942,"logger":"argo-events.eventsource","caller":"calendar/start.go:144","msg":"resolving calendar schedule...","eventSourceName":"e2e-calendar-ha","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125815.6214216,"logger":"argo-events.eventsource","caller":"calendar/start.go:150","msg":"parsing exclusion dates if any...","eventSourceName":"e2e-calendar-ha","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125815.6215122,"logger":"argo-events.eventsource","caller":"calendar/start.go:162","msg":"Persistence not enabled","eventSourceName":"e2e-calendar-ha","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125815.62153,"logger":"argo-events.eventsource","caller":"calendar/start.go:225","msg":"Calendar event start time:","eventSourceName":"e2e-calendar-ha","eventSourceType":"calendar","eventName":"example","Time":"02 Jan 22 12:16 UTC"}
{"level":"info","ts":1641125815.6215498,"logger":"argo-events.eventsource","caller":"calendar/start.go:249","msg":"expected next calendar event","eventSourceName":"e2e-calendar-ha","eventSourceType":"calendar","eventName":"example","time":"2022-01-02 12:16:57 +0000 UTC"}
{"level":"info","ts":1641125817.0008566,"logger":"argo-events.eventsource","caller":"calendar/start.go:209","msg":"dispatching calendar event...","eventSourceName":"e2e-calendar-ha","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125817.0024576,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:451","msg":"succeeded to publish an event","eventSourceName":"e2e-calendar-ha","eventName":"example","eventSourceType":"calendar","eventID":"34313531616236302d313737312d346361622d613564622d636632343932616433656430"}
    functional_test.go:74: Creating sensor e2e-log-ha
    functional_test.go:75: Pod of Sensor e2e-log-ha is running
    functional_test.go:76: Waiting for 3s
    functional_test.go:76: Done waiting
Watching POD: e2e-log-ha-sensor-h9r6x-6dcf4f9569-j2r9w
Watching POD: e2e-log-ha-sensor-h9r6x-6dcf4f9569-jmf7x
{"level":"info","ts":1641125818.622633,"logger":"argo-events.sensor","caller":"metrics/metrics.go:172","msg":"starting metrics server","sensorName":"e2e-log-ha"}
{"level":"warn","ts":1641125818.6335688,"logger":"argo-events.sensor","caller":"cmd/start.go:76","msg":"WARNING: unable to initialise Codefresh API","sensorName":"e2e-log-ha","error":"configmaps \"codefresh-cm\" not found"}
{"level":"info","ts":1641125818.6336226,"logger":"argo-events.sensor","caller":"cmd/start.go:79","msg":"starting sensor server","sensorName":"e2e-log-ha","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125818.6388242,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","sensorName":"e2e-log-ha"}
{"level":"info","ts":1641125818.6839597,"logger":"argo-events.sensor","caller":"metrics/metrics.go:172","msg":"starting metrics server","sensorName":"e2e-log-ha"}
{"level":"warn","ts":1641125818.6880095,"logger":"argo-events.sensor","caller":"cmd/start.go:76","msg":"WARNING: unable to initialise Codefresh API","sensorName":"e2e-log-ha","error":"configmaps \"codefresh-cm\" not found"}
{"level":"info","ts":1641125818.688056,"logger":"argo-events.sensor","caller":"cmd/start.go:79","msg":"starting sensor server","sensorName":"e2e-log-ha","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125818.6914227,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","sensorName":"e2e-log-ha"}
{"level":"info","ts":1641125819.2662468,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","sensorName":"e2e-log-ha"}
{"level":"info","ts":1641125819.267683,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","sensorName":"e2e-log-ha"}
{"level":"info","ts":1641125819.26774,"logger":"argo-events.sensor","caller":"sensors/listener.go:344","msg":"Sensor started.","sensorName":"e2e-log-ha"}
{"level":"info","ts":1641125819.2677598,"logger":"argo-events.sensor","caller":"sensors/listener.go:490","msg":"Dependency expression for trigger log-trigger: test-dep","sensorName":"e2e-log-ha"}
{"level":"info","ts":1641125819.268137,"logger":"argo-events.sensor","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","sensorName":"e2e-log-ha","triggerName":"log-trigger","clientID":"client-3517268675-55"}
{"level":"info","ts":1641125819.2695503,"logger":"argo-events.sensor","caller":"driver/nats.go:105","msg":"Connected to NATS server.","sensorName":"e2e-log-ha","triggerName":"log-trigger","clientID":"client-3517268675-55"}
{"level":"info","ts":1641125819.2704403,"logger":"argo-events.sensor","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","sensorName":"e2e-log-ha","triggerName":"log-trigger","clientID":"client-3517268675-55"}
{"level":"info","ts":1641125819.2704802,"logger":"argo-events.sensor","caller":"sensors/listener.go:303","msg":"starting eventbus connection daemon for client client-3517268675-55...","sensorName":"e2e-log-ha"}
{"level":"info","ts":1641125819.2705195,"logger":"argo-events.sensor","caller":"sensors/listener.go:255","msg":"started subscribing to events for trigger log-trigger with client client-3517268675-55","sensorName":"e2e-log-ha"}
{"level":"info","ts":1641125819.271664,"logger":"argo-events.sensor","caller":"driver/nats.go:161","msg":"Subscribed to subject eventbus-argo-events ...","sensorName":"e2e-log-ha","triggerName":"log-trigger","clientID":"client-3517268675-55"}
{"level":"info","ts":1641125819.2717187,"logger":"argo-events.sensor","caller":"driver/nats.go:169","msg":"starting ExactOnce cache clean up daemon ...","sensorName":"e2e-log-ha","triggerName":"log-trigger","clientID":"client-3517268675-55"}
{"level":"info","ts":1641125821.0021808,"logger":"argo-events.sensor","caller":"log/log.go:46","msg":"{\"eventTime\":\"2022-01-02 12:17:01.000101545 +0000 UTC m=+6.293583892\"}","sensorName":"e2e-log-ha","triggerName":"log-trigger","triggerType":"Log","dependencyName":"test-dep","eventContext":"{\"id:\" \"38383238316265612d653330622d346430662d383964352d323231303761653032646232\", \"source\": \"e2e-calendar-ha\", \"specversion\": \"1.0\", \"type\": \"calendar\", \"datacontenttype\": \"application/json\", \"subject\": \"example\", \"time\": \"2022-01-02 12:17:01.000217447 +0000 UTC\"}"}
{"level":"info","ts":1641125821.0022624,"logger":"argo-events.sensor","caller":"sensors/listener.go:434","msg":"successfully processed the trigger","sensorName":"e2e-log-ha","triggerName":"log-trigger","triggerType":"Log","triggeredBy":["test-dep"],"triggeredByEvents":["38383238316265612d653330622d346430662d383964352d323231303761653032646232"]}
=== RUN   TestFunctionalSuite/TestMetricsWithCalendar
    functional_test.go:84: Creating event source e2e-calendar-metrics
    functional_test.go:85: Pod of EventSource e2e-calendar-metrics is running
Watching POD: e2e-calendar-metrics-eventsource-5vck9-7954fb8fbd-pmnvn
{"level":"info","ts":1641125822.6850865,"logger":"argo-events.eventsource","caller":"metrics/metrics.go:172","msg":"starting metrics server","eventSourceName":"e2e-calendar-metrics"}
{"level":"warn","ts":1641125822.6887057,"logger":"argo-events.eventsource","caller":"cmd/start.go:66","msg":"WARNING: unable to initialise Codefresh API","eventSourceName":"e2e-calendar-metrics","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125822.6888452,"logger":"argo-events.eventsource","caller":"cmd/start.go:69","msg":"starting eventsource server","eventSourceName":"e2e-calendar-metrics","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125822.6907723,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","eventSourceName":"e2e-calendar-metrics"}
{"level":"info","ts":1641125823.508215,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","eventSourceName":"e2e-calendar-metrics"}
{"level":"info","ts":1641125823.5085385,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","eventSourceName":"e2e-calendar-metrics"}
{"level":"info","ts":1641125823.5085857,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:322","msg":"Starting event source server...","eventSourceName":"e2e-calendar-metrics"}
{"level":"info","ts":1641125823.5088556,"logger":"argo-events.eventsource","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","eventSourceName":"e2e-calendar-metrics","clientID":"client-e2e-calendar-metrics-eventsource-5vck9-7954fb8fbd-pmnvn-183"}
{"level":"info","ts":1641125823.5105875,"logger":"argo-events.eventsource","caller":"driver/nats.go:105","msg":"Connected to NATS server.","eventSourceName":"e2e-calendar-metrics","clientID":"client-e2e-calendar-metrics-eventsource-5vck9-7954fb8fbd-pmnvn-183"}
{"level":"info","ts":1641125823.5129673,"logger":"argo-events.eventsource","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","eventSourceName":"e2e-calendar-metrics","clientID":"client-e2e-calendar-metrics-eventsource-5vck9-7954fb8fbd-pmnvn-183"}
{"level":"info","ts":1641125823.5131507,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:466","msg":"Eventing server started.","eventSourceName":"e2e-calendar-metrics"}
    then.go:77: EventSource POD name: e2e-calendar-metrics-eventsource-5vck9-7954fb8fbd-pmnvn
Forwarding from 127.0.0.1:7777 -> 7777
Forwarding from [::1]:7777 -> 7777
Watching POD: e2e-calendar-metrics-eventsource-5vck9-7954fb8fbd-pmnvn
{"level":"info","ts":1641125822.6850865,"logger":"argo-events.eventsource","caller":"metrics/metrics.go:172","msg":"starting metrics server","eventSourceName":"e2e-calendar-metrics"}
{"level":"warn","ts":1641125822.6887057,"logger":"argo-events.eventsource","caller":"cmd/start.go:66","msg":"WARNING: unable to initialise Codefresh API","eventSourceName":"e2e-calendar-metrics","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125822.6888452,"logger":"argo-events.eventsource","caller":"cmd/start.go:69","msg":"starting eventsource server","eventSourceName":"e2e-calendar-metrics","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125822.6907723,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","eventSourceName":"e2e-calendar-metrics"}
{"level":"info","ts":1641125823.508215,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","eventSourceName":"e2e-calendar-metrics"}
{"level":"info","ts":1641125823.5085385,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","eventSourceName":"e2e-calendar-metrics"}
{"level":"info","ts":1641125823.5085857,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:322","msg":"Starting event source server...","eventSourceName":"e2e-calendar-metrics"}
{"level":"info","ts":1641125823.5088556,"logger":"argo-events.eventsource","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","eventSourceName":"e2e-calendar-metrics","clientID":"client-e2e-calendar-metrics-eventsource-5vck9-7954fb8fbd-pmnvn-183"}
{"level":"info","ts":1641125823.5105875,"logger":"argo-events.eventsource","caller":"driver/nats.go:105","msg":"Connected to NATS server.","eventSourceName":"e2e-calendar-metrics","clientID":"client-e2e-calendar-metrics-eventsource-5vck9-7954fb8fbd-pmnvn-183"}
{"level":"info","ts":1641125823.5129673,"logger":"argo-events.eventsource","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","eventSourceName":"e2e-calendar-metrics","clientID":"client-e2e-calendar-metrics-eventsource-5vck9-7954fb8fbd-pmnvn-183"}
{"level":"info","ts":1641125823.5131507,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:466","msg":"Eventing server started.","eventSourceName":"e2e-calendar-metrics"}
{"level":"info","ts":1641125823.513238,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:354","msg":"starting eventbus connection daemon...","eventSourceName":"e2e-calendar-metrics"}
{"level":"info","ts":1641125823.5134895,"logger":"argo-events.eventsource","caller":"calendar/start.go:141","msg":"started processing the calendar event source...","eventSourceName":"e2e-calendar-metrics","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125823.513566,"logger":"argo-events.eventsource","caller":"calendar/start.go:144","msg":"resolving calendar schedule...","eventSourceName":"e2e-calendar-metrics","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125823.5136297,"logger":"argo-events.eventsource","caller":"calendar/start.go:150","msg":"parsing exclusion dates if any...","eventSourceName":"e2e-calendar-metrics","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125823.513732,"logger":"argo-events.eventsource","caller":"calendar/start.go:162","msg":"Persistence not enabled","eventSourceName":"e2e-calendar-metrics","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125823.5142548,"logger":"argo-events.eventsource","caller":"calendar/start.go:225","msg":"Calendar event start time:","eventSourceName":"e2e-calendar-metrics","eventSourceType":"calendar","eventName":"example","Time":"02 Jan 22 12:17 UTC"}
{"level":"info","ts":1641125823.5143864,"logger":"argo-events.eventsource","caller":"calendar/start.go:249","msg":"expected next calendar event","eventSourceName":"e2e-calendar-metrics","eventSourceType":"calendar","eventName":"example","time":"2022-01-02 12:17:05 +0000 UTC"}
{"level":"info","ts":1641125825.0010188,"logger":"argo-events.eventsource","caller":"calendar/start.go:209","msg":"dispatching calendar event...","eventSourceName":"e2e-calendar-metrics","eventSourceType":"calendar","eventName":"example"}
{"level":"info","ts":1641125825.004055,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:451","msg":"succeeded to publish an event","eventSourceName":"e2e-calendar-metrics","eventName":"example","eventSourceType":"calendar","eventID":"65386639396136652d613962352d343162622d396263302d383761663838613531663230"}
Handling connection for 7777
    functional_test.go:105: Creating sensor e2e-log-metrics
    functional_test.go:106: Pod of Sensor e2e-log-metrics is running
Watching POD: e2e-log-metrics-sensor-6628k-6b6c6d74f7-r77cz
{"level":"info","ts":1641125825.9790702,"logger":"argo-events.sensor","caller":"metrics/metrics.go:172","msg":"starting metrics server","sensorName":"e2e-log-metrics"}
{"level":"warn","ts":1641125825.9842708,"logger":"argo-events.sensor","caller":"cmd/start.go:76","msg":"WARNING: unable to initialise Codefresh API","sensorName":"e2e-log-metrics","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125825.9843144,"logger":"argo-events.sensor","caller":"cmd/start.go:79","msg":"starting sensor server","sensorName":"e2e-log-metrics","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125825.9863992,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","sensorName":"e2e-log-metrics"}
{"level":"info","ts":1641125826.6771843,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","sensorName":"e2e-log-metrics"}
{"level":"info","ts":1641125826.6778038,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","sensorName":"e2e-log-metrics"}
{"level":"info","ts":1641125826.6780717,"logger":"argo-events.sensor","caller":"sensors/listener.go:344","msg":"Sensor started.","sensorName":"e2e-log-metrics"}
    then.go:98: Sensor POD name: e2e-log-metrics-sensor-6628k-6b6c6d74f7-r77cz
Forwarding from 127.0.0.1:7778 -> 7777
Forwarding from [::1]:7778 -> 7777
Watching POD: e2e-log-metrics-sensor-6628k-6b6c6d74f7-r77cz
{"level":"info","ts":1641125825.9790702,"logger":"argo-events.sensor","caller":"metrics/metrics.go:172","msg":"starting metrics server","sensorName":"e2e-log-metrics"}
{"level":"warn","ts":1641125825.9842708,"logger":"argo-events.sensor","caller":"cmd/start.go:76","msg":"WARNING: unable to initialise Codefresh API","sensorName":"e2e-log-metrics","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125825.9843144,"logger":"argo-events.sensor","caller":"cmd/start.go:79","msg":"starting sensor server","sensorName":"e2e-log-metrics","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125825.9863992,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","sensorName":"e2e-log-metrics"}
{"level":"info","ts":1641125826.6771843,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","sensorName":"e2e-log-metrics"}
{"level":"info","ts":1641125826.6778038,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","sensorName":"e2e-log-metrics"}
{"level":"info","ts":1641125826.6780717,"logger":"argo-events.sensor","caller":"sensors/listener.go:344","msg":"Sensor started.","sensorName":"e2e-log-metrics"}
{"level":"info","ts":1641125826.6782134,"logger":"argo-events.sensor","caller":"sensors/listener.go:490","msg":"Dependency expression for trigger log-trigger: test-dep","sensorName":"e2e-log-metrics"}
{"level":"info","ts":1641125826.6787734,"logger":"argo-events.sensor","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","sensorName":"e2e-log-metrics","triggerName":"log-trigger","clientID":"client-2931116143-39"}
{"level":"info","ts":1641125826.6802382,"logger":"argo-events.sensor","caller":"driver/nats.go:105","msg":"Connected to NATS server.","sensorName":"e2e-log-metrics","triggerName":"log-trigger","clientID":"client-2931116143-39"}
{"level":"info","ts":1641125826.6813993,"logger":"argo-events.sensor","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","sensorName":"e2e-log-metrics","triggerName":"log-trigger","clientID":"client-2931116143-39"}
{"level":"info","ts":1641125826.6814344,"logger":"argo-events.sensor","caller":"sensors/listener.go:303","msg":"starting eventbus connection daemon for client client-2931116143-39...","sensorName":"e2e-log-metrics"}
{"level":"info","ts":1641125826.6815178,"logger":"argo-events.sensor","caller":"sensors/listener.go:255","msg":"started subscribing to events for trigger log-trigger with client client-2931116143-39","sensorName":"e2e-log-metrics"}
{"level":"info","ts":1641125826.6825078,"logger":"argo-events.sensor","caller":"driver/nats.go:161","msg":"Subscribed to subject eventbus-argo-events ...","sensorName":"e2e-log-metrics","triggerName":"log-trigger","clientID":"client-2931116143-39"}
{"level":"info","ts":1641125826.682535,"logger":"argo-events.sensor","caller":"driver/nats.go:169","msg":"starting ExactOnce cache clean up daemon ...","sensorName":"e2e-log-metrics","triggerName":"log-trigger","clientID":"client-2931116143-39"}
{"level":"info","ts":1641125827.002266,"logger":"argo-events.sensor","caller":"log/log.go:46","msg":"{\"eventTime\":\"2022-01-02 12:17:07.000529581 +0000 UTC m=+4.359085538\"}","sensorName":"e2e-log-metrics","triggerName":"log-trigger","triggerType":"Log","dependencyName":"test-dep","eventContext":"{\"id:\" \"30663963393763392d303763662d343034612d623539362d373638363263626461386364\", \"source\": \"e2e-calendar-metrics\", \"specversion\": \"1.0\", \"type\": \"calendar\", \"datacontenttype\": \"application/json\", \"subject\": \"example\", \"time\": \"2022-01-02 12:17:07.000639582 +0000 UTC\"}"}
{"level":"info","ts":1641125827.0023289,"logger":"argo-events.sensor","caller":"sensors/listener.go:434","msg":"successfully processed the trigger","sensorName":"e2e-log-metrics","triggerName":"log-trigger","triggerType":"Log","triggeredBy":["test-dep"],"triggeredByEvents":["30663963393763392d303763662d343034612d623539362d373638363263626461386364"]}
Handling connection for 7778
    then.go:114: Terminating port-forward for POD e2e-log-metrics-sensor-6628k-6b6c6d74f7-r77cz
    then.go:114: Terminating port-forward for POD e2e-calendar-metrics-eventsource-5vck9-7954fb8fbd-pmnvn
=== RUN   TestFunctionalSuite/TestMetricsWithWebhook
    functional_test.go:127: Creating event source e2e-test-metrics-webhook
    functional_test.go:128: Pod of EventSource e2e-test-metrics-webhook is running
Watching POD: e2e-test-metrics-webhook-eventsource-m4gdx-64548fc759-xl2hp
{"level":"info","ts":1641125828.052595,"logger":"argo-events.eventsource","caller":"metrics/metrics.go:172","msg":"starting metrics server","eventSourceName":"e2e-test-metrics-webhook"}
{"level":"warn","ts":1641125828.058077,"logger":"argo-events.eventsource","caller":"cmd/start.go:66","msg":"WARNING: unable to initialise Codefresh API","eventSourceName":"e2e-test-metrics-webhook","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125828.0581357,"logger":"argo-events.eventsource","caller":"cmd/start.go:69","msg":"starting eventsource server","eventSourceName":"e2e-test-metrics-webhook","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125828.0581663,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:322","msg":"Starting event source server...","eventSourceName":"e2e-test-metrics-webhook"}
{"level":"info","ts":1641125828.0584533,"logger":"argo-events.eventsource","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","eventSourceName":"e2e-test-metrics-webhook","clientID":"client-e2e-test-metrics-webhook-eventsource-m4gdx-64548fc759-xl2hp-827"}
{"level":"info","ts":1641125828.0612633,"logger":"argo-events.eventsource","caller":"driver/nats.go:105","msg":"Connected to NATS server.","eventSourceName":"e2e-test-metrics-webhook","clientID":"client-e2e-test-metrics-webhook-eventsource-m4gdx-64548fc759-xl2hp-827"}
{"level":"info","ts":1641125828.0638702,"logger":"argo-events.eventsource","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","eventSourceName":"e2e-test-metrics-webhook","clientID":"client-e2e-test-metrics-webhook-eventsource-m4gdx-64548fc759-xl2hp-827"}
{"level":"info","ts":1641125828.063904,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:466","msg":"Eventing server started.","eventSourceName":"e2e-test-metrics-webhook"}
    then.go:77: EventSource POD name: e2e-test-metrics-webhook-eventsource-m4gdx-64548fc759-xl2hp
Forwarding from 127.0.0.1:12000 -> 12000
Forwarding from [::1]:12000 -> 12000
    then.go:77: EventSource POD name: e2e-test-metrics-webhook-eventsource-m4gdx-64548fc759-xl2hp
Forwarding from 127.0.0.1:7777 -> 7777
Forwarding from [::1]:7777 -> 7777
    functional_test.go:138: Creating sensor e2e-test-metrics
    functional_test.go:139: Pod of Sensor e2e-test-metrics is running
Watching POD: e2e-test-metrics-sensor-q8qtr-7cbbd79fc9-hqhst
{"level":"info","ts":1641125829.319083,"logger":"argo-events.sensor","caller":"metrics/metrics.go:172","msg":"starting metrics server","sensorName":"e2e-test-metrics"}
{"level":"warn","ts":1641125829.3227863,"logger":"argo-events.sensor","caller":"cmd/start.go:76","msg":"WARNING: unable to initialise Codefresh API","sensorName":"e2e-test-metrics","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125829.3228245,"logger":"argo-events.sensor","caller":"cmd/start.go:79","msg":"starting sensor server","sensorName":"e2e-test-metrics","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125829.3246517,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9017053,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9017627,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.901804,"logger":"argo-events.sensor","caller":"sensors/listener.go:344","msg":"Sensor started.","sensorName":"e2e-test-metrics"}
    then.go:98: Sensor POD name: e2e-test-metrics-sensor-q8qtr-7cbbd79fc9-hqhst
Forwarding from 127.0.0.1:7778 -> 7777
Forwarding from [::1]:7778 -> 7777
Handling connection for 12000
Watching POD: e2e-test-metrics-webhook-eventsource-m4gdx-64548fc759-xl2hp
{"level":"info","ts":1641125828.052595,"logger":"argo-events.eventsource","caller":"metrics/metrics.go:172","msg":"starting metrics server","eventSourceName":"e2e-test-metrics-webhook"}
{"level":"warn","ts":1641125828.058077,"logger":"argo-events.eventsource","caller":"cmd/start.go:66","msg":"WARNING: unable to initialise Codefresh API","eventSourceName":"e2e-test-metrics-webhook","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125828.0581357,"logger":"argo-events.eventsource","caller":"cmd/start.go:69","msg":"starting eventsource server","eventSourceName":"e2e-test-metrics-webhook","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125828.0581663,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:322","msg":"Starting event source server...","eventSourceName":"e2e-test-metrics-webhook"}
{"level":"info","ts":1641125828.0584533,"logger":"argo-events.eventsource","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","eventSourceName":"e2e-test-metrics-webhook","clientID":"client-e2e-test-metrics-webhook-eventsource-m4gdx-64548fc759-xl2hp-827"}
{"level":"info","ts":1641125828.0612633,"logger":"argo-events.eventsource","caller":"driver/nats.go:105","msg":"Connected to NATS server.","eventSourceName":"e2e-test-metrics-webhook","clientID":"client-e2e-test-metrics-webhook-eventsource-m4gdx-64548fc759-xl2hp-827"}
{"level":"info","ts":1641125828.0638702,"logger":"argo-events.eventsource","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","eventSourceName":"e2e-test-metrics-webhook","clientID":"client-e2e-test-metrics-webhook-eventsource-m4gdx-64548fc759-xl2hp-827"}
{"level":"info","ts":1641125828.063904,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:466","msg":"Eventing server started.","eventSourceName":"e2e-test-metrics-webhook"}
{"level":"info","ts":1641125828.063963,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:354","msg":"starting eventbus connection daemon...","eventSourceName":"e2e-test-metrics-webhook"}
{"level":"info","ts":1641125828.06403,"logger":"argo-events.eventsource","caller":"webhook/start.go:150","msg":"started processing the webhook event source...","eventSourceName":"e2e-test-metrics-webhook","eventSourceType":"webhook","eventName":"example"}
{"level":"info","ts":1641125828.0640385,"logger":"argo-events.eventsource","caller":"webhook/webhook.go:214","msg":"validating the route...","eventSourceName":"e2e-test-metrics-webhook","eventSourceType":"webhook","eventName":"example"}
{"level":"info","ts":1641125828.06405,"logger":"argo-events.eventsource","caller":"webhook/webhook.go:220","msg":"listening to payloads for the route...","eventSourceName":"e2e-test-metrics-webhook","eventSourceType":"webhook","eventName":"example"}
{"level":"info","ts":1641125828.0640554,"logger":"argo-events.eventsource","caller":"webhook/webhook.go:227","msg":"activating the route...","eventSourceName":"e2e-test-metrics-webhook","eventSourceType":"webhook","eventName":"example"}
{"level":"info","ts":1641125828.0641272,"logger":"argo-events.eventsource","caller":"webhook/webhook.go:177","msg":"route is activated","eventSourceName":"e2e-test-metrics-webhook","eventSourceType":"webhook","eventName":"example","port":"12000","endpoint":"/example"}
{"level":"info","ts":1641125828.0641415,"logger":"argo-events.eventsource","caller":"webhook/webhook.go:230","msg":"running operations post route activation...","eventSourceName":"e2e-test-metrics-webhook","eventSourceType":"webhook","eventName":"example"}
{"level":"info","ts":1641125830.9708047,"logger":"argo-events.eventsource","caller":"webhook/start.go:96","msg":"a request received, processing it...","eventSourceName":"e2e-test-metrics-webhook","eventSourceType":"webhook","eventName":"example","endpoint":"/example","port":"12000","http-method":"POST"}
{"level":"info","ts":1641125830.970949,"logger":"argo-events.eventsource","caller":"webhook/start.go:130","msg":"dispatching event on route's data channel...","eventSourceName":"e2e-test-metrics-webhook","eventSourceType":"webhook","eventName":"example","endpoint":"/example","port":"12000","http-method":"POST"}
{"level":"info","ts":1641125830.9709609,"logger":"argo-events.eventsource","caller":"webhook/start.go:132","msg":"successfully processed the request","eventSourceName":"e2e-test-metrics-webhook","eventSourceType":"webhook","eventName":"example","endpoint":"/example","port":"12000","http-method":"POST"}
{"level":"info","ts":1641125830.9710634,"logger":"argo-events.eventsource","caller":"webhook/webhook.go:187","msg":"new event received, dispatching it...","eventSourceName":"e2e-test-metrics-webhook","eventSourceType":"webhook","eventName":"example"}
{"level":"info","ts":1641125830.9760075,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:451","msg":"succeeded to publish an event","eventSourceName":"e2e-test-metrics-webhook","eventName":"example","eventSourceType":"webhook","eventID":"31363666613562322d353435382d346338642d383032612d656534613561396165656466"}
Handling connection for 12000
Handling connection for 7777
Watching POD: e2e-test-metrics-sensor-q8qtr-7cbbd79fc9-hqhst
{"level":"info","ts":1641125829.319083,"logger":"argo-events.sensor","caller":"metrics/metrics.go:172","msg":"starting metrics server","sensorName":"e2e-test-metrics"}
{"level":"warn","ts":1641125829.3227863,"logger":"argo-events.sensor","caller":"cmd/start.go:76","msg":"WARNING: unable to initialise Codefresh API","sensorName":"e2e-test-metrics","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125829.3228245,"logger":"argo-events.sensor","caller":"cmd/start.go:79","msg":"starting sensor server","sensorName":"e2e-test-metrics","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125829.3246517,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9017053,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9017627,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.901804,"logger":"argo-events.sensor","caller":"sensors/listener.go:344","msg":"Sensor started.","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9018283,"logger":"argo-events.sensor","caller":"sensors/listener.go:490","msg":"Dependency expression for trigger http-trigger: test-dep","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9020495,"logger":"argo-events.sensor","caller":"sensors/listener.go:490","msg":"Dependency expression for trigger log-trigger: test-dep","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.904123,"logger":"argo-events.sensor","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","sensorName":"e2e-test-metrics","triggerName":"log-trigger","clientID":"client-3542350965-34"}
{"level":"info","ts":1641125829.9021468,"logger":"argo-events.sensor","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","sensorName":"e2e-test-metrics","triggerName":"http-trigger","clientID":"client-696573589-17"}
{"level":"info","ts":1641125829.9060779,"logger":"argo-events.sensor","caller":"driver/nats.go:105","msg":"Connected to NATS server.","sensorName":"e2e-test-metrics","triggerName":"log-trigger","clientID":"client-3542350965-34"}
{"level":"info","ts":1641125829.9060664,"logger":"argo-events.sensor","caller":"driver/nats.go:105","msg":"Connected to NATS server.","sensorName":"e2e-test-metrics","triggerName":"http-trigger","clientID":"client-696573589-17"}
{"level":"info","ts":1641125829.906997,"logger":"argo-events.sensor","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","sensorName":"e2e-test-metrics","triggerName":"log-trigger","clientID":"client-3542350965-34"}
{"level":"info","ts":1641125829.9070406,"logger":"argo-events.sensor","caller":"sensors/listener.go:303","msg":"starting eventbus connection daemon for client client-3542350965-34...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9070523,"logger":"argo-events.sensor","caller":"sensors/listener.go:255","msg":"started subscribing to events for trigger log-trigger with client client-3542350965-34","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9079056,"logger":"argo-events.sensor","caller":"driver/nats.go:161","msg":"Subscribed to subject eventbus-argo-events ...","sensorName":"e2e-test-metrics","triggerName":"log-trigger","clientID":"client-3542350965-34"}
{"level":"info","ts":1641125829.9080107,"logger":"argo-events.sensor","caller":"driver/nats.go:169","msg":"starting ExactOnce cache clean up daemon ...","sensorName":"e2e-test-metrics","triggerName":"log-trigger","clientID":"client-3542350965-34"}
{"level":"info","ts":1641125829.909093,"logger":"argo-events.sensor","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","sensorName":"e2e-test-metrics","triggerName":"http-trigger","clientID":"client-696573589-17"}
{"level":"info","ts":1641125829.9091144,"logger":"argo-events.sensor","caller":"sensors/listener.go:303","msg":"starting eventbus connection daemon for client client-696573589-17...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9091268,"logger":"argo-events.sensor","caller":"sensors/listener.go:255","msg":"started subscribing to events for trigger http-trigger with client client-696573589-17","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.91018,"logger":"argo-events.sensor","caller":"driver/nats.go:161","msg":"Subscribed to subject eventbus-argo-events ...","sensorName":"e2e-test-metrics","triggerName":"http-trigger","clientID":"client-696573589-17"}
{"level":"info","ts":1641125829.9102154,"logger":"argo-events.sensor","caller":"driver/nats.go:169","msg":"starting ExactOnce cache clean up daemon ...","sensorName":"e2e-test-metrics","triggerName":"http-trigger","clientID":"client-696573589-17"}
{"level":"info","ts":1641125830.973248,"logger":"argo-events.sensor","caller":"log/log.go:46","msg":"{\"header\":{\"Accept-Encoding\":[\"gzip\"],\"Content-Length\":[\"2\"],\"User-Agent\":[\"Go-http-client/1.1\"]},\"body\":{}}","sensorName":"e2e-test-metrics","triggerName":"log-trigger","triggerType":"Log","dependencyName":"test-dep","eventContext":"{\"id:\" \"31363666613562322d353435382d346338642d383032612d656534613561396165656466\", \"source\": \"e2e-test-metrics-webhook\", \"specversion\": \"1.0\", \"type\": \"webhook\", \"datacontenttype\": \"application/json\", \"subject\": \"example\", \"time\": \"2022-01-02 12:17:10.971334391 +0000 UTC\"}"}
{"level":"info","ts":1641125830.9732945,"logger":"argo-events.sensor","caller":"sensors/listener.go:434","msg":"successfully processed the trigger","sensorName":"e2e-test-metrics","triggerName":"log-trigger","triggerType":"Log","triggeredBy":["test-dep"],"triggeredByEvents":["31363666613562322d353435382d346338642d383032612d656534613561396165656466"]}
Watching POD: e2e-test-metrics-sensor-q8qtr-7cbbd79fc9-hqhst
{"level":"info","ts":1641125829.319083,"logger":"argo-events.sensor","caller":"metrics/metrics.go:172","msg":"starting metrics server","sensorName":"e2e-test-metrics"}
{"level":"warn","ts":1641125829.3227863,"logger":"argo-events.sensor","caller":"cmd/start.go:76","msg":"WARNING: unable to initialise Codefresh API","sensorName":"e2e-test-metrics","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125829.3228245,"logger":"argo-events.sensor","caller":"cmd/start.go:79","msg":"starting sensor server","sensorName":"e2e-test-metrics","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125829.3246517,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9017053,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9017627,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.901804,"logger":"argo-events.sensor","caller":"sensors/listener.go:344","msg":"Sensor started.","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9018283,"logger":"argo-events.sensor","caller":"sensors/listener.go:490","msg":"Dependency expression for trigger http-trigger: test-dep","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9020495,"logger":"argo-events.sensor","caller":"sensors/listener.go:490","msg":"Dependency expression for trigger log-trigger: test-dep","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.904123,"logger":"argo-events.sensor","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","sensorName":"e2e-test-metrics","triggerName":"log-trigger","clientID":"client-3542350965-34"}
{"level":"info","ts":1641125829.9021468,"logger":"argo-events.sensor","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","sensorName":"e2e-test-metrics","triggerName":"http-trigger","clientID":"client-696573589-17"}
{"level":"info","ts":1641125829.9060779,"logger":"argo-events.sensor","caller":"driver/nats.go:105","msg":"Connected to NATS server.","sensorName":"e2e-test-metrics","triggerName":"log-trigger","clientID":"client-3542350965-34"}
{"level":"info","ts":1641125829.9060664,"logger":"argo-events.sensor","caller":"driver/nats.go:105","msg":"Connected to NATS server.","sensorName":"e2e-test-metrics","triggerName":"http-trigger","clientID":"client-696573589-17"}
{"level":"info","ts":1641125829.906997,"logger":"argo-events.sensor","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","sensorName":"e2e-test-metrics","triggerName":"log-trigger","clientID":"client-3542350965-34"}
{"level":"info","ts":1641125829.9070406,"logger":"argo-events.sensor","caller":"sensors/listener.go:303","msg":"starting eventbus connection daemon for client client-3542350965-34...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9070523,"logger":"argo-events.sensor","caller":"sensors/listener.go:255","msg":"started subscribing to events for trigger log-trigger with client client-3542350965-34","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9079056,"logger":"argo-events.sensor","caller":"driver/nats.go:161","msg":"Subscribed to subject eventbus-argo-events ...","sensorName":"e2e-test-metrics","triggerName":"log-trigger","clientID":"client-3542350965-34"}
{"level":"info","ts":1641125829.9080107,"logger":"argo-events.sensor","caller":"driver/nats.go:169","msg":"starting ExactOnce cache clean up daemon ...","sensorName":"e2e-test-metrics","triggerName":"log-trigger","clientID":"client-3542350965-34"}
{"level":"info","ts":1641125829.909093,"logger":"argo-events.sensor","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","sensorName":"e2e-test-metrics","triggerName":"http-trigger","clientID":"client-696573589-17"}
{"level":"info","ts":1641125829.9091144,"logger":"argo-events.sensor","caller":"sensors/listener.go:303","msg":"starting eventbus connection daemon for client client-696573589-17...","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.9091268,"logger":"argo-events.sensor","caller":"sensors/listener.go:255","msg":"started subscribing to events for trigger http-trigger with client client-696573589-17","sensorName":"e2e-test-metrics"}
{"level":"info","ts":1641125829.91018,"logger":"argo-events.sensor","caller":"driver/nats.go:161","msg":"Subscribed to subject eventbus-argo-events ...","sensorName":"e2e-test-metrics","triggerName":"http-trigger","clientID":"client-696573589-17"}
{"level":"info","ts":1641125829.9102154,"logger":"argo-events.sensor","caller":"driver/nats.go:169","msg":"starting ExactOnce cache clean up daemon ...","sensorName":"e2e-test-metrics","triggerName":"http-trigger","clientID":"client-696573589-17"}
{"level":"info","ts":1641125830.973248,"logger":"argo-events.sensor","caller":"log/log.go:46","msg":"{\"header\":{\"Accept-Encoding\":[\"gzip\"],\"Content-Length\":[\"2\"],\"User-Agent\":[\"Go-http-client/1.1\"]},\"body\":{}}","sensorName":"e2e-test-metrics","triggerName":"log-trigger","triggerType":"Log","dependencyName":"test-dep","eventContext":"{\"id:\" \"31363666613562322d353435382d346338642d383032612d656534613561396165656466\", \"source\": \"e2e-test-metrics-webhook\", \"specversion\": \"1.0\", \"type\": \"webhook\", \"datacontenttype\": \"application/json\", \"subject\": \"example\", \"time\": \"2022-01-02 12:17:10.971334391 +0000 UTC\"}"}
{"level":"info","ts":1641125830.9732945,"logger":"argo-events.sensor","caller":"sensors/listener.go:434","msg":"successfully processed the trigger","sensorName":"e2e-test-metrics","triggerName":"log-trigger","triggerType":"Log","triggeredBy":["test-dep"],"triggeredByEvents":["31363666613562322d353435382d346338642d383032612d656534613561396165656466"]}
{"level":"info","ts":1641125830.9738832,"logger":"argo-events.sensor","caller":"http/http.go:194","msg":"making a http request...","sensorName":"e2e-test-metrics","triggerName":"http-trigger","triggerType":"HTTP","url":"https://not-existing.com/"}
{"level":"error","ts":1641125831.005453,"logger":"argo-events.sensor","caller":"sensors/listener.go:373","msg":"failed to execute a trigger","sensorName":"e2e-test-metrics","error":"failed to execute trigger: timed out waiting for the condition: Get \"https://not-existing.com/\": dial tcp: lookup not-existing.com on 10.43.0.10:53: no such host","errorVerbose":"timed out waiting for the condition: Get \"https://not-existing.com/\": dial tcp: lookup not-existing.com on 10.43.0.10:53: no such host\nfailed to execute trigger\ngithub.com/argoproj/argo-events/sensors.(*SensorContext).triggerOne\n\t/home/runner/work/argo-events/argo-events/sensors/listener.go:426\ngithub.com/argoproj/argo-events/sensors.(*SensorContext).triggerWithRateLimit\n\t/home/runner/work/argo-events/argo-events/sensors/listener.go:371\nruntime.goexit\n\t/opt/hostedtoolcache/go/1.17.1/x64/src/runtime/asm_amd64.s:1581","triggerName":"http-trigger","triggeredBy":["test-dep"],"triggeredByEvents":["31363666613562322d353435382d346338642d383032612d656534613561396165656466"],"stacktrace":"github.com/argoproj/argo-events/sensors.(*SensorContext).triggerWithRateLimit\n\t/home/runner/work/argo-events/argo-events/sensors/listener.go:373"}
Handling connection for 7778
    then.go:114: Terminating port-forward for POD e2e-test-metrics-sensor-q8qtr-7cbbd79fc9-hqhst
    then.go:114: Terminating port-forward for POD e2e-test-metrics-webhook-eventsource-m4gdx-64548fc759-xl2hp
=== RUN   TestFunctionalSuite/TestResourceEventSource
    functional_test.go:184: Creating event source test-resource
    functional_test.go:185: Pod of EventSource test-resource is running
/usr/local/bin/kubectl -n argo-events run test-pod --image hello-world -l argo-events-e2e=true
pod/test-pod created

Watching POD: test-resource-eventsource-qzlvb-5c4f4875b7-gpnqw
{"level":"info","ts":1641125832.2050207,"logger":"argo-events.eventsource","caller":"metrics/metrics.go:172","msg":"starting metrics server","eventSourceName":"test-resource"}
{"level":"warn","ts":1641125832.2100368,"logger":"argo-events.eventsource","caller":"cmd/start.go:66","msg":"WARNING: unable to initialise Codefresh API","eventSourceName":"test-resource","error":"configmaps \"codefresh-cm\" not found"}
{"level":"info","ts":1641125832.2100768,"logger":"argo-events.eventsource","caller":"cmd/start.go:69","msg":"starting eventsource server","eventSourceName":"test-resource","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125832.2120109,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","eventSourceName":"test-resource"}
{"level":"info","ts":1641125833.0270722,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","eventSourceName":"test-resource"}
{"level":"info","ts":1641125833.0275154,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","eventSourceName":"test-resource"}
{"level":"info","ts":1641125833.0277643,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:322","msg":"Starting event source server...","eventSourceName":"test-resource"}
{"level":"info","ts":1641125833.0282624,"logger":"argo-events.eventsource","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","eventSourceName":"test-resource","clientID":"client-test-resource-eventsource-qzlvb-5c4f4875b7-gpnqw-845"}
{"level":"info","ts":1641125833.0297408,"logger":"argo-events.eventsource","caller":"driver/nats.go:105","msg":"Connected to NATS server.","eventSourceName":"test-resource","clientID":"client-test-resource-eventsource-qzlvb-5c4f4875b7-gpnqw-845"}
{"level":"info","ts":1641125833.031153,"logger":"argo-events.eventsource","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","eventSourceName":"test-resource","clientID":"client-test-resource-eventsource-qzlvb-5c4f4875b7-gpnqw-845"}
{"level":"info","ts":1641125833.0311882,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:466","msg":"Eventing server started.","eventSourceName":"test-resource"}
    functional_test.go:193: Creating sensor e2e-resource-log
    functional_test.go:194: Pod of Sensor e2e-resource-log is running
Watching POD: e2e-resource-log-sensor-dlvdf-7dc47b8c94-l58kw
{"level":"info","ts":1641125834.3551345,"logger":"argo-events.sensor","caller":"metrics/metrics.go:172","msg":"starting metrics server","sensorName":"e2e-resource-log"}
{"level":"warn","ts":1641125834.3600073,"logger":"argo-events.sensor","caller":"cmd/start.go:76","msg":"WARNING: unable to initialise Codefresh API","sensorName":"e2e-resource-log","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125834.3600478,"logger":"argo-events.sensor","caller":"cmd/start.go:79","msg":"starting sensor server","sensorName":"e2e-resource-log","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125834.361723,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","sensorName":"e2e-resource-log"}
{"level":"info","ts":1641125835.1332362,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","sensorName":"e2e-resource-log"}
{"level":"info","ts":1641125835.1336315,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","sensorName":"e2e-resource-log"}
{"level":"info","ts":1641125835.133674,"logger":"argo-events.sensor","caller":"sensors/listener.go:344","msg":"Sensor started.","sensorName":"e2e-resource-log"}
/usr/local/bin/kubectl -n argo-events delete pod test-pod
pod "test-pod" deleted

Watching POD: test-resource-eventsource-qzlvb-5c4f4875b7-gpnqw
{"level":"info","ts":1641125832.2050207,"logger":"argo-events.eventsource","caller":"metrics/metrics.go:172","msg":"starting metrics server","eventSourceName":"test-resource"}
{"level":"warn","ts":1641125832.2100368,"logger":"argo-events.eventsource","caller":"cmd/start.go:66","msg":"WARNING: unable to initialise Codefresh API","eventSourceName":"test-resource","error":"configmaps \"codefresh-cm\" not found"}
{"level":"info","ts":1641125832.2100768,"logger":"argo-events.eventsource","caller":"cmd/start.go:69","msg":"starting eventsource server","eventSourceName":"test-resource","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125832.2120109,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","eventSourceName":"test-resource"}
{"level":"info","ts":1641125833.0270722,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","eventSourceName":"test-resource"}
{"level":"info","ts":1641125833.0275154,"logger":"argo-events.eventsource","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","eventSourceName":"test-resource"}
{"level":"info","ts":1641125833.0277643,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:322","msg":"Starting event source server...","eventSourceName":"test-resource"}
{"level":"info","ts":1641125833.0282624,"logger":"argo-events.eventsource","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","eventSourceName":"test-resource","clientID":"client-test-resource-eventsource-qzlvb-5c4f4875b7-gpnqw-845"}
{"level":"info","ts":1641125833.0297408,"logger":"argo-events.eventsource","caller":"driver/nats.go:105","msg":"Connected to NATS server.","eventSourceName":"test-resource","clientID":"client-test-resource-eventsource-qzlvb-5c4f4875b7-gpnqw-845"}
{"level":"info","ts":1641125833.031153,"logger":"argo-events.eventsource","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","eventSourceName":"test-resource","clientID":"client-test-resource-eventsource-qzlvb-5c4f4875b7-gpnqw-845"}
{"level":"info","ts":1641125833.0311882,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:466","msg":"Eventing server started.","eventSourceName":"test-resource"}
{"level":"info","ts":1641125833.0312386,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:354","msg":"starting eventbus connection daemon...","eventSourceName":"test-resource"}
{"level":"info","ts":1641125833.0315294,"logger":"argo-events.eventsource","caller":"resource/start.go:85","msg":"setting up a K8s client","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125833.0317485,"logger":"argo-events.eventsource","caller":"resource/start.go:108","msg":"configuring label selectors if filters are selected...","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125833.0317647,"logger":"argo-events.eventsource","caller":"resource/start.go:121","msg":"setting up informer factory...","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125833.0317914,"logger":"argo-events.eventsource","caller":"resource/start.go:237","msg":"running informer...","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125833.032084,"logger":"argo-events.eventsource","caller":"resource/start.go:174","msg":"listening to resource events...","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125835.9087598,"logger":"argo-events.eventsource","caller":"resource/start.go:219","msg":"detected delete event","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125835.908849,"logger":"argo-events.eventsource","caller":"resource/start.go:289","msg":"Event happened before service start time. event-timestamp: 2022-01-02 12:17:11 +0000 UTC, start-timestamp: 2022-01-02 12:17:13.031779906 +0000 UTC\n","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125836.3092575,"logger":"argo-events.eventsource","caller":"resource/start.go:219","msg":"detected delete event","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125836.3093958,"logger":"argo-events.eventsource","caller":"resource/start.go:289","msg":"Event happened before service start time. event-timestamp: 2022-01-02 12:17:02 +0000 UTC, start-timestamp: 2022-01-02 12:17:13.031779906 +0000 UTC\n","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125836.706169,"logger":"argo-events.eventsource","caller":"resource/start.go:219","msg":"detected delete event","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125836.706243,"logger":"argo-events.eventsource","caller":"resource/start.go:289","msg":"Event happened before service start time. event-timestamp: 2022-01-02 12:17:07 +0000 UTC, start-timestamp: 2022-01-02 12:17:13.031779906 +0000 UTC\n","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125837.105842,"logger":"argo-events.eventsource","caller":"resource/start.go:219","msg":"detected delete event","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125837.1059175,"logger":"argo-events.eventsource","caller":"resource/start.go:289","msg":"Event happened before service start time. event-timestamp: 2022-01-02 12:17:02 +0000 UTC, start-timestamp: 2022-01-02 12:17:13.031779906 +0000 UTC\n","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125837.5065434,"logger":"argo-events.eventsource","caller":"resource/start.go:219","msg":"detected delete event","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125837.5067697,"logger":"argo-events.eventsource","caller":"resource/start.go:289","msg":"Event happened before service start time. event-timestamp: 2022-01-02 12:17:02 +0000 UTC, start-timestamp: 2022-01-02 12:17:13.031779906 +0000 UTC\n","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125845.7207637,"logger":"argo-events.eventsource","caller":"resource/start.go:219","msg":"detected delete event","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125845.7208245,"logger":"argo-events.eventsource","caller":"resource/start.go:289","msg":"Event happened before service start time. event-timestamp: 2022-01-02 12:17:11 +0000 UTC, start-timestamp: 2022-01-02 12:17:13.031779906 +0000 UTC\n","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125845.7389452,"logger":"argo-events.eventsource","caller":"resource/start.go:219","msg":"detected delete event","eventSourceName":"test-resource","eventSourceType":"resource","eventName":"example"}
{"level":"info","ts":1641125845.7419333,"logger":"argo-events.eventsource","caller":"eventsources/eventing.go:451","msg":"succeeded to publish an event","eventSourceName":"test-resource","eventName":"example","eventSourceType":"resource","eventID":"35386663333434342d356563312d343731642d626336302d383230653937373339343536"}
Watching POD: e2e-resource-log-sensor-dlvdf-7dc47b8c94-l58kw
{"level":"info","ts":1641125834.3551345,"logger":"argo-events.sensor","caller":"metrics/metrics.go:172","msg":"starting metrics server","sensorName":"e2e-resource-log"}
{"level":"warn","ts":1641125834.3600073,"logger":"argo-events.sensor","caller":"cmd/start.go:76","msg":"WARNING: unable to initialise Codefresh API","sensorName":"e2e-resource-log","error":"configmaps \"codefresh-cm\" is forbidden: User \"system:serviceaccount:argo-events:default\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"argo-events\""}
{"level":"info","ts":1641125834.3600478,"logger":"argo-events.sensor","caller":"cmd/start.go:79","msg":"starting sensor server","sensorName":"e2e-resource-log","version":"55cadbfb3cfd42f8ea900a41a287c55c0b00aa3a+55cadbf"}
{"level":"info","ts":1641125834.361723,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:122","msg":"Not the LEADER, stand by ...","sensorName":"e2e-resource-log"}
{"level":"info","ts":1641125835.1332362,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:131","msg":"Becoming a Candidate, stand by ...","sensorName":"e2e-resource-log"}
{"level":"info","ts":1641125835.1336315,"logger":"argo-events.sensor","caller":"leaderelection/leaderelection.go:128","msg":"I'm the LEADER, starting ...","sensorName":"e2e-resource-log"}
{"level":"info","ts":1641125835.133674,"logger":"argo-events.sensor","caller":"sensors/listener.go:344","msg":"Sensor started.","sensorName":"e2e-resource-log"}
{"level":"info","ts":1641125835.133693,"logger":"argo-events.sensor","caller":"sensors/listener.go:490","msg":"Dependency expression for trigger log-trigger: test-dep","sensorName":"e2e-resource-log"}
{"level":"info","ts":1641125835.1339495,"logger":"argo-events.sensor","caller":"driver/nats.go:93","msg":"NATS auth strategy: Token","sensorName":"e2e-resource-log","triggerName":"log-trigger","clientID":"client-3850055984-70"}
{"level":"info","ts":1641125835.135923,"logger":"argo-events.sensor","caller":"driver/nats.go:105","msg":"Connected to NATS server.","sensorName":"e2e-resource-log","triggerName":"log-trigger","clientID":"client-3850055984-70"}
{"level":"info","ts":1641125835.1378677,"logger":"argo-events.sensor","caller":"driver/nats.go:118","msg":"Connected to NATS streaming server.","sensorName":"e2e-resource-log","triggerName":"log-trigger","clientID":"client-3850055984-70"}
{"level":"info","ts":1641125835.1378958,"logger":"argo-events.sensor","caller":"sensors/listener.go:303","msg":"starting eventbus connection daemon for client client-3850055984-70...","sensorName":"e2e-resource-log"}
{"level":"info","ts":1641125835.137911,"logger":"argo-events.sensor","caller":"sensors/listener.go:255","msg":"started subscribing to events for trigger log-trigger with client client-3850055984-70","sensorName":"e2e-resource-log"}
{"level":"info","ts":1641125835.1393397,"logger":"argo-events.sensor","caller":"driver/nats.go:161","msg":"Subscribed to subject eventbus-argo-events ...","sensorName":"e2e-resource-log","triggerName":"log-trigger","clientID":"client-3850055984-70"}
{"level":"info","ts":1641125835.1394207,"logger":"argo-events.sensor","caller":"driver/nats.go:169","msg":"starting ExactOnce cache clean up daemon ...","sensorName":"e2e-resource-log","triggerName":"log-trigger","clientID":"client-3850055984-70"}
{"level":"info","ts":1641125845.741662,"logger":"argo-events.sensor","caller":"log/log.go:46","msg":"{\"type\":\"DELETE\",\"body\":{\"apiVersion\":\"v1\",\"kind\":\"Pod\",\"metadata\":{\"creationTimestamp\":\"2022-01-02T12:17:13Z\",\"deletionGracePeriodSeconds\":0,\"deletionTimestamp\":\"2022-01-02T12:17:15Z\",\"labels\":{\"argo-events-e2e\":\"true\"},\"managedFields\":[{\"apiVersion\":\"v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:metadata\":{\"f:labels\":{\".\":{},\"f:argo-events-e2e\":{}}},\"f:spec\":{\"f:containers\":{\"k:{\\\"name\\\":\\\"test-pod\\\"}\":{\".\":{},\"f:image\":{},\"f:imagePullPolicy\":{},\"f:name\":{},\"f:resources\":{},\"f:terminationMessagePath\":{},\"f:terminationMessagePolicy\":{}}},\"f:dnsPolicy\":{},\"f:enableServiceLinks\":{},\"f:restartPolicy\":{},\"f:schedulerName\":{},\"f:securityContext\":{},\"f:terminationGracePeriodSeconds\":{}}},\"manager\":\"kubectl-run\",\"operation\":\"Update\",\"time\":\"2022-01-02T12:17:13Z\"},{\"apiVersion\":\"v1\",\"fieldsType\":\"FieldsV1\",\"fieldsV1\":{\"f:status\":{\"f:conditions\":{\"k:{\\\"type\\\":\\\"ContainersReady\\\"}\":{\".\":{},\"f:lastProbeTime\":{},\"f:lastTransitionTime\":{},\"f:message\":{},\"f:reason\":{},\"f:status\":{},\"f:type\":{}},\"k:{\\\"type\\\":\\\"Initialized\\\"}\":{\".\":{},\"f:lastProbeTime\":{},\"f:lastTransitionTime\":{},\"f:status\":{},\"f:type\":{}},\"k:{\\\"type\\\":\\\"Ready\\\"}\":{\".\":{},\"f:lastProbeTime\":{},\"f:lastTransitionTime\":{},\"f:message\":{},\"f:reason\":{},\"f:status\":{},\"f:type\":{}}},\"f:containerStatuses\":{},\"f:hostIP\":{},\"f:podIP\":{},\"f:podIPs\":{\".\":{},\"k:{\\\"ip\\\":\\\"10.42.0.27\\\"}\":{\".\":{},\"f:ip\":{}}},\"f:startTime\":{}}},\"manager\":\"k3s\",\"operation\":\"Update\",\"time\":\"2022-01-02T12:17:18Z\"}],\"name\":\"test-pod\",\"namespace\":\"argo-events\",\"resourceVersion\":\"1420\",\"uid\":\"5f67aee3-bfe1-48b6-91dc-0f3473b27051\"},\"spec\":{\"containers\":[{\"image\":\"hello-world\",\"imagePullPolicy\":\"Always\",\"name\":\"test-pod\",\"resources\":{},\"terminationMessagePath\":\"/dev/termination-log\",\"terminationMessagePolicy\":\"File\",\"volumeMounts\":[{\"mountPath\":\"/var/run/secrets/kubernetes.io/serviceaccount\",\"name\":\"kube-api-access-cxwgd\",\"readOnly\":true}]}],\"dnsPolicy\":\"ClusterFirst\",\"enableServiceLinks\":true,\"nodeName\":\"k3d-e2e-server-0\",\"preemptionPolicy\":\"PreemptLowerPriority\",\"priority\":0,\"restartPolicy\":\"Always\",\"schedulerName\":\"default-scheduler\",\"securityContext\":{},\"serviceAccount\":\"default\",\"serviceAccountName\":\"default\",\"terminationGracePeriodSeconds\":30,\"tolerations\":[{\"effect\":\"NoExecute\",\"key\":\"node.kubernetes.io/not-ready\",\"operator\":\"Exists\",\"tolerationSeconds\":300},{\"effect\":\"NoExecute\",\"key\":\"node.kubernetes.io/unreachable\",\"operator\":\"Exists\",\"tolerationSeconds\":300}],\"volumes\":[{\"name\":\"kube-api-access-cxwgd\",\"projected\":{\"defaultMode\":420,\"sources\":[{\"serviceAccountToken\":{\"expirationSeconds\":3607,\"path\":\"token\"}},{\"configMap\":{\"items\":[{\"key\":\"ca.crt\",\"path\":\"ca.crt\"}],\"name\":\"kube-root-ca.crt\"}},{\"downwardAPI\":{\"items\":[{\"fieldRef\":{\"apiVersion\":\"v1\",\"fieldPath\":\"metadata.namespace\"},\"path\":\"namespace\"}]}}]}}]},\"status\":{\"conditions\":[{\"lastProbeTime\":null,\"lastTransitionTime\":\"2022-01-02T12:17:13Z\",\"status\":\"True\",\"type\":\"Initialized\"},{\"lastProbeTime\":null,\"lastTransitionTime\":\"2022-01-02T12:17:13Z\",\"message\":\"containers with unready status: [test-pod]\",\"reason\":\"ContainersNotReady\",\"status\":\"False\",\"type\":\"Ready\"},{\"lastProbeTime\":null,\"lastTransitionTime\":\"2022-01-02T12:17:13Z\",\"message\":\"containers with unready status: [test-pod]\",\"reason\":\"ContainersNotReady\",\"status\":\"False\",\"type\":\"ContainersReady\"},{\"lastProbeTime\":null,\"lastTransitionTime\":\"2022-01-02T12:17:13Z\",\"status\":\"True\",\"type\":\"PodScheduled\"}],\"containerStatuses\":[{\"image\":\"hello-world\",\"imageID\":\"\",\"lastState\":{},\"name\":\"test-pod\",\"ready\":false,\"restartCount\":0,\"started\":false,\"state\":{\"waiting\":{\"reason\":\"ContainerCreating\"}}}],\"hostIP\":\"172.18.0.3\",\"phase\":\"Pending\",\"podIP\":\"10.42.0.27\",\"podIPs\":[{\"ip\":\"10.42.0.27\"}],\"qosClass\":\"BestEffort\",\"startTime\":\"2022-01-02T12:17:13Z\"}},\"oldBody\":null,\"group\":\"\",\"version\":\"v1\",\"resource\":\"pods\"}","sensorName":"e2e-resource-log","triggerName":"log-trigger","triggerType":"Log","dependencyName":"test-dep","eventContext":"{\"id:\" \"35386663333434342d356563312d343731642d626336302d383230653937373339343536\", \"source\": \"test-resource\", \"specversion\": \"1.0\", \"type\": \"resource\", \"datacontenttype\": \"application/json\", \"subject\": \"example\", \"time\": \"2022-01-02 12:17:25.739593605 +0000 UTC\"}"}
{"level":"info","ts":1641125845.7417533,"logger":"argo-events.sensor","caller":"sensors/listener.go:434","msg":"successfully processed the trigger","sensorName":"e2e-resource-log","triggerName":"log-trigger","triggerType":"Log","triggeredBy":["test-dep"],"triggeredByEvents":["35386663333434342d356563312d343731642d626336302d383230653937373339343536"]}
=== CONT  TestFunctionalSuite
    e2e_suite.go:87: Deleting event bus argo-events-e2e
    e2e_suite.go:88: Waiting for 3s
    e2e_suite.go:88: Done waiting
    e2e_suite.go:91: EventBus is deleted
--- PASS: TestFunctionalSuite (50.36s)
    --- PASS: TestFunctionalSuite/TestCreateCalendarEventSource (8.13s)
    --- PASS: TestFunctionalSuite/TestCreateCalendarEventSourceWithHA (7.97s)
    --- PASS: TestFunctionalSuite/TestMetricsWithCalendar (5.03s)
    --- PASS: TestFunctionalSuite/TestMetricsWithWebhook (4.06s)
    --- PASS: TestFunctionalSuite/TestResourceEventSource (14.73s)
PASS
ok  	github.com/argoproj/argo-events/test/e2e	50.377s
